####  把服务器上的openssl升级

``` shell
# 下载openssl二进制包
cd /data/software
wget https://www.openssl.org/source/openssl-1.1.1i.tar.gz

# 解压进入解压后的目录
tar xf openssl-1.1.1i.tar.gz
cd openssl-1.1.1i/

# 安装环境依赖并且编译
yum install gcc gcc-c++ autoconf automake
./config shared zlib
make && make install

# 备份老命令
mv /usr/bin/openssl /usr/bin/openssl.bak
mv /usr/include/openssl /usr/include/openssl.bak

# 查找新命令做好软连接
find / -name openssl
ln -s /usr/local/bin/openssl /usr/bin/openssl
ln -s /usr/local/include/openssl /usr/include/openssl

# 设置环境变量
echo "/usr/local/lib64/" >> /etc/ld.so.conf
ldconfig 
openssl version -a
```

#### 配置证书颁发机构
``` shell
mkdir -pv /usr/local/ssl/CA/{newcerts,crl,private,test}
touch index.txt serial crlnumber crl.pem index.txt.attr

# 修改如下配置文件
vim /usr/local/ssl/openssl.cnf
45 dir             = /usr/local/ssl/CA
53 certificate     = $dir/root_cacert_ecc.pem
58 private_key     = $dir/private/root_prikey_ecdsa.pem
88 stateOrProvinceName     = optional
89 organizationName        = optional

```

#### 生成私钥
``` shell
# 密钥加密一
openssl ecparam -genkey -name prime256v1 -aes128 -passout pass:test123 -out root_prikey_ecdsa.pem

# 密钥加密二
openssl ecparam -genkey -name prime256v1  -out root_prikey_ecdsa.pem
openssl ec -in root_prikey_ecdsa.pem -aes128 -passout pass:test123 -out root_prikey_ecdsa.pem

# 测试一下密钥读取,是否需要输入密码
openssl ec -in root_prikey_ecdsa.pem -text
```

#### 生成自签根证书
``` shell
openssl req -new -x509 -key root_prikey_ecdsa.pem -out root_cacert_ecc.pem -days 730 -subj /C=CN/ST=BeiJing/O=CAtest/OU=CAtest/CN=root_ca/emailAddress=xusxlinux@163.com

# 把私钥和配置文件的对应起来
mv root_prikey_ecdsa.pem private/
```

#### 签发证书
``` shell
# 初始值,只需要操作一次就够了
openssl rand -hex 16 > /usr/local/ssl/CA/serial


openssl genrsa -out rsa_01prikey.pem
openssl req -new -key rsa_01prikey.pem  -out rsa_01cert.csr -days 365 -subj /C=CN/ST=ShangHai/L=ShangHai/O=test01/OU=test01/CN=www.test01.com/emailAddress=adm@test01.com
openssl ca -in rsa_01cert.csr  -md sha384  -out  rsa_01cert.crt  -days 365 -batch -notext


# 先生成私钥
-rw-------. 1 root root 1679 Jul 19 15:21 rsa_01prikey.pem
# 在证书申请
-rw-r--r--. 1 root root 1058 Jul 19 15:21 rsa_01cert.csr
# 签出来的证书
-rw-r--r--. 1 root root 1172 Jul 19 15:22 rsa_01cert.crt

# 使用x509命名查看 生成的证书
openssl x509 -in rsa_01cert.crt -text
```

#### 吊销证书
``` shell

```
