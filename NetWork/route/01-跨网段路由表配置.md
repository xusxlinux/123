## 跨网段通信
#### 环境准备
|主机名|角色名称|公网IP|内网IP
|:----|:----|:----|:----|
|路由|node-route.host.com|92.204.160.131|VMnet1 172.16.10.10 <br> VMnet2 172.16.20.10 <br> VMnet3 172.16.30.10|
|区域 a|zone a|有/无|172.16.10.0/24|
|区域 b|zone b|有/无|172.16.20.0/24|
|区域 c|zone c|有/无|172.16.30.0/24|

## 路由服务器设置
#### # 第一张内网网卡
``` shell
vim /etc/sysconfig/network-scripts/ifcfg-eth1
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
NAME=eth1
DEVICE=eth1
IPADDR=172.16.10.10
```
#### # 第二张内网网卡
``` shell
vim /etc/sysconfig/network-scripts/ifcfg-eth2
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
NAME=eth2
DEVICE=eth2
IPADDR=172.16.20.10
```

## `zone a` 和 `zone b` 网段规划
#### zone a 服务器网卡设置
``` shell
vim /etc/sysconfig/network-scripts/ifcfg-eth1 
TYPE=Ethernet
BOOTPROTO=static
ONBOOT=yes
NAME=eth1
DEVICE=eth1
IPADDR=172.16.10.12
# 这里需要添加路由器上配置的网关 路由表上配置eth1的网关
GATEWAY=172.16.10.10
NETMASK=255.255.255.0
```
#### zone b 服务器网卡设置
``` shell
vim /etc/sysconfig/network-scripts/ifcfg-eth1 
TYPE=Ethernet
BOOTPROTO=static
ONBOOT=yes
NAME=eth1
DEVICE=eth1
IPADDR=172.16.20.22
# 这里需要添加路由器上配置的网关 路由表上配置eth2的网关
GATEWAY=172.16.20.10
NETMASK=255.255.255.0
```

## 最关键的一步 在Linux路由服务器上 `添加路由表`
#### 永久路由表
``` shell
vim /etc/sysconfig/network-scripts/route-eth1
vim /etc/sysconfig/network-scripts/route-eth2
```
#### 临时路由表
``` shell
# 如果eth1网卡上是B类地址, 需要删除后重新添加
route del -net 172.16.0.0 gw 0.0.0.0 netmask 255.255.0.0 dev eth1
ip route add 172.16.10.0/24 via 0.0.0.0 dev eth1

# 添加路由转发
ip route add 172.16.10.0/24 via 172.16.10.10 dev eth1


# 如果eth2网卡上是B类地址, 需要删除后重新添加
route del -net 172.16.0.0 gw 0.0.0.0 netmask 255.255.0.0 dev eth2
ip route add 172.16.20.0/24 via 0.0.0.0 dev eth2

# 添加路由转发
ip route add 172.16.20.0/24  via 172.16.20.10 dev eth2
```
