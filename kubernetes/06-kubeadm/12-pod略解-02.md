
ProjectVolume

Secret

ConfigMap

DownwardAPI


- [x] 完成一个例子

``` yaml
[root@hdss7-200 k8s_02]# cat pod-secret.yaml

apiVersion: v1
# 这个资源类型可以直接热加载
kind: Secret
metadata:
  name: dbpass
# Opaque不透明
type: Opaque
data:
  # base64加密
  username: a3ViZXJuZXRlcw==
  passwd:  a3ViZXJuZXRlcw==
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-secret
spec:
  containers:
  - name: tomcat
    image: xusx/tomcat:8.0.22
    ports:
    - containerPort: 8080
    volumeMounts:
    - name: db-secret
      # 容器内挂载的目录
      mountPath: /db-secret
      readOnly: true
  volumes:
  - name: db-secret
    projected:
      sources:
      - secret:
          # secret的名字
          name: dbpass
```

``` shell
# 这时候进入到容器内  查看文件, 是明文密码
[root@hdss7-22 ~]# docker exec -it 8a524d2a5c44 bash

root@pod-secret:/db-secret# cat passwd 
kubernete
root@pod-secret:/db-secret# cat username
kubernete
```

#### configMap的两种使用方式
一
``` yaml
# 这个是程序的配置文件
[root@hdss7-200 k8s_02]# vim game.properties 

# 可以使用热加载的形式
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30

```
``` shell
# 创建一个configMap资源类型 名字叫做web-game
[root@hdss7-200 k8s_02]# kubectl create configmap web-game --from-file=game.properties -n test
```
``` yaml
[root@hdss7-200 k8s_02]# vim pod-configmap.yaml 

apiVersion: v1
kind: Pod
metadata:
  name: pod-game
spec:
  containers:
  - name: tomcat
    image: xusx/tomcat:8.0.22
    ports:
    - containerPort: 8080
    volumeMounts:
    - name: game
      mountPath: /etc/config/game
      readOnly: true
  volumes:
  - name: game
    projected:
      sources:
      - configMap:
          name: web-game
```
``` shell
[root@hdss7-200 ~]# docker exec -it 52d11b278973 bash

root@pod-game:/usr/local/tomcat# cat /etc/config/game/game.properties 
enemies=aliens
lives=3
enemies.cheat=true
enemies.cheat.level=noGoodRotten
secret.code.passphrase=UUDDLRLRBABAS
secret.code.allowed=true
secret.code.lives=30
```
二
 2.1
``` yaml
[root@hdss7-200 k8s_02]# vim configmap.yml 

apiVersion: v1
kind: ConfigMap
metadata:
  name: configs
data:
  JAVA_OPTS: -Xms1024m
  LOG_LEVEL: DEBUG
```

``` yaml
[root@hdss7-200 k8s_02]# vim pod-env.yaml 

apiVersion: v1
kind: Pod
metadata:
  name: pod-env
spec:
  containers:
  - name: web
    image: xusx/jre8:8u112
    ports:
    - containerPort: 8080
    env:
      - name: LOG_LEVEL_CONFIG
        valueFrom:
          configMapKeyRef:
            name: configs
            key: LOG_LEVEL
```

``` shell
# configmap的 环境变量使用方式
[root@hdss7-200 ~]# kubectl exec -it pod-env -n test -- bash

root@pod-env:/usr/local/tomcat# env | grep LOG_LEVEL
LOG_LEVEL_CONFIG=DEBUG
```
 2.2
``` yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-cmd
spec:
  containers:
  - name: web
    image: xusx/springboot-web:v1
    command: ["/bin/sh", "-c", "java -jar /springboot-web.jar -DJAVA_OPTS=$(JAVA_OPTS)"]
    ports:
    - containerPort: 8080
    env:
      - name: JAVA_OPTS
        valueFrom:
          configMapKeyRef:
            name: configs
            key: JAVA_OPTS
```

#### downwardapi的两种使用方式
``` yaml
[root@hdss7-200 k8s_02]# vim pod-downwardapi.yaml 

apiVersion: v1
kind: Pod
metadata:
  name: pod-downwardapi
  labels:
    app: downwardapi
    type: webapp
spec:
  containers:
  - name: web
    image: xusx/tomcat:8.0.22
    ports:
    - containerPort: 8080
    volumeMounts:
      - name: podinfo
        mountPath: /etc/podinfo
  volumes:
    - name: podinfo
      projected:
        sources:
        - downwardAPI:
            items:
              - path: "labels"
                fieldRef:
                  fieldPath: metadata.labels
              - path: "name"
                fieldRef:
                  fieldPath: metadata.name
              - path: "namespace"
                fieldRef:
                  fieldPath: metadata.namespace
              - path: "mem-request"
                resourceFieldRef:
                  containerName: web
                  resource: limits.memory
```

``` shell
[root@hdss7-11 ~]# docker exec -it d23157defb17 bash

root@pod-downwardapi:/usr/local/tomcat# cat /etc/podinfo/mem-request 
8245784576

root@pod-downwardapi:/usr/local/tomcat# cat /etc/podinfo/labels 
app="downwardapi"
type="webapp"

root@pod-downwardapi:/usr/local/tomcat# cat /etc/podinfo/name
pod-downwardapi

root@pod-downwardapi:/usr/local/tomcat# cat /etc/podinfo/namespace 
test
```
